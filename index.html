<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Attendance Monitoring System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #print-section, #print-section * {
                visibility: visible;
            }
            #print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
            }
            table {
                font-size: 10px;
            }
            th, td {
                border: 1px solid #ccc;
                padding: 4px;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="app" class="container mx-auto p-4 md:p-8 max-w-6xl">
        <header class="mb-8">
            <div class="flex justify-between items-center">
                <div></div> <!-- Spacer -->
                <div class="text-center">
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Sistem Kehadiran Pelajar 2025/2026</h1>
                    <p class="text-gray-500 mt-2">Pemantauan Kehadiran Pelajar Sesi 2025/2026</p>
                </div>
                <div id="online-status" class="text-right">
                    <!-- Status indicator will be added here -->
                </div>
            </div>
             <div class="text-center mt-4">
                <button id="migrate-data-btn" class="hidden px-4 py-2 bg-amber-500 text-white font-semibold rounded-md shadow-md hover:bg-amber-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-400 transition duration-150">
                    Pindah Data Lama ke Online
                </button>
            </div>
        </header>

        <!-- Tabs -->
        <div class="mb-6 border-b border-gray-200">
            <nav class="flex space-x-4" aria-label="Tabs">
                <button id="tab-entry" class="px-3 py-2 font-medium text-sm rounded-t-md tab-active">Catat Kehadiran</button>
                <button id="tab-dashboard" class="px-3 py-2 font-medium text-sm rounded-t-md text-gray-500 hover:text-gray-700">Papar Kehadiran</button>
                <button id="tab-summary" class="px-3 py-2 font-medium text-sm rounded-t-md text-gray-500 hover:text-gray-700">Ringkasan Kelas</button>
            </nav>
        </div>

        <!-- Main Content -->
        <main>
            <!-- Attendance Entry Section -->
            <div id="content-entry">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold mb-6 text-gray-700">Daftar Kehadiran</h2>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div>
                            <label for="entry-date" class="block text-sm font-medium text-gray-600 mb-1">Tarikh</label>
                            <input type="date" id="entry-date" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="entry-time" class="block text-sm font-medium text-gray-600 mb-1">Masa</label>
                            <input type="time" id="entry-time" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="entry-class" class="block text-sm font-medium text-gray-600 mb-1">Nama Kelas</label>
                            <select id="entry-class" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <!-- Options will be populated by JS -->
                            </select>
                        </div>
                        <div>
                            <label for="entry-class-type" class="block text-sm font-medium text-gray-600 mb-1">Mod Kelas</label>
                            <select id="entry-class-type" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <!-- Options will be populated by JS -->
                            </select>
                        </div>
                    </div>

                    <!-- Holiday/Remark Section -->
                    <div class="mt-6 border-t pt-4">
                        <div class="flex items-center">
                            <input id="session-remark-toggle" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <label for="session-remark-toggle" class="ml-2 block text-sm font-medium text-gray-700">Tandakan sesi ini sebagai Cuti Umum atau Acara Khas (tiada kehadiran diambil)</label>
                        </div>
                        <div id="session-remark-container" class="hidden mt-4">
                            <label for="session-remark-input" class="block text-sm font-medium text-gray-600 mb-1">Sebab / Catatan</label>
                            <input type="text" id="session-remark-input" placeholder="Cth: Cuti Hari Kemerdekaan, Kelas Batal" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    
                    <h3 id="student-list-header" class="text-lg font-semibold text-gray-700 my-4 border-t pt-4">Senarai Pelajar</h3>
                    <div id="student-list" class="space-y-4">
                        <!-- Student rows will be populated by JS -->
                    </div>

                    <div class="mt-8 flex justify-end">
                        <button id="submit-attendance" class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-md shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150">
                            Catat Kehadiran
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="content-dashboard" class="hidden">
                 <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-700">Data Kehadiran Pelajar</h2>
                        <button id="print-report-btn" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-md shadow-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition duration-150 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v6a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd" />
                            </svg>
                            Cetak Laporan
                        </button>
                    </div>
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                         <div>
                             <label for="dashboard-class" class="block text-sm font-medium text-gray-600 mb-1">Pilih Kelas</label>
                             <select id="dashboard-class" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                 <!-- Options will be populated by JS -->
                             </select>
                         </div>
                         <div>
                            <label for="dashboard-class-type" class="block text-sm font-medium text-gray-600 mb-1">Pilih Mod Kelas</label>
                            <select id="dashboard-class-type" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <!-- Options will be populated by JS -->
                            </select>
                        </div>
                        <div>
                            <label for="dashboard-month" class="block text-sm font-medium text-gray-600 mb-1">Pilih Bulan</label>
                            <select id="dashboard-month" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <!-- Options will be populated by JS -->
                            </select>
                        </div>
                     </div>

                     <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Pelajar</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">% Kehadiran</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Ketidakhadiran</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Tindakan</th>
                                </tr>
                            </thead>
                            <tbody id="dashboard-body" class="bg-white divide-y divide-gray-200">
                                <!-- Dashboard rows will be populated by JS -->
                            </tbody>
                        </table>
                    </div>
                 </div>
            </div>

            <!-- Summary Section -->
            <div id="content-summary" class="hidden">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold mb-6 text-gray-700">Ringkasan Kehadiran Keseluruhan</h2>
                    <div class="mb-6">
                        <label for="summary-month" class="block text-sm font-medium text-gray-600 mb-1">Tapis Mengikut Bulan</label>
                        <select id="summary-month" class="w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <!-- Options will be populated by JS -->
                        </select>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Kelas</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Jumlah Kelas Dijalankan</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Kehadiran Keseluruhan (%)</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kehadiran Tertinggi</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kehadiran Terendah</th>
                                </tr>
                            </thead>
                            <tbody id="summary-body" class="bg-white divide-y divide-gray-200">
                                <!-- Summary rows will be populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="remarks-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-11/12 md:max-w-lg mx-auto p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800" id="modal-student-name"></h3>
                <button id="close-modal" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div id="modal-remarks-content" class="text-sm text-gray-600 space-y-2 max-h-60 overflow-y-auto"></div>
        </div>
    </div>
    <div id="sessions-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-11/12 md:max-w-lg mx-auto p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800" id="sessions-modal-title"></h3>
                <button id="close-sessions-modal" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div id="sessions-modal-content" class="text-sm text-gray-600 space-y-2 max-h-60 overflow-y-auto"></div>
        </div>
    </div>
    <div id="delete-confirm-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-11/12 md:max-w-md mx-auto p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Sahkan Padam</h3>
            <p id="delete-confirm-message" class="text-gray-600 mb-6"></p>
            <div class="flex justify-end space-x-4">
                <button id="cancel-delete-btn" class="px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-md hover:bg-gray-300">Batal</button>
                <button id="confirm-delete-btn" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700">Padam</button>
            </div>
        </div>
    </div>
    <div id="custom-alert" class="fixed top-5 right-5 z-50 bg-green-500 text-white py-2 px-4 rounded-lg shadow-md hidden transition-transform translate-x-full">
        <p id="alert-message"></p>
    </div>

    <!-- Printable Report Section -->
    <div id="print-section">
        <div id="print-header" class="mb-4"></div>
        <table id="print-table" class="w-full border-collapse"></table>
        <div id="print-summary" class="mt-4"></div>
        <div id="print-footer" class="mt-8 text-sm"></div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const app = {
                // --- CONFIGURATION ---
                googleSheetUrl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRlfpghvp8zv38Kj6EpVEeQzALCIh71ZrmH2WwxlhcOEo1C16I_xXP1Fvqruu6p_qPvlPw37TWYlbzy/pub?output=csv',
                
                // ** TAMPAL (PASTE) SUPABASE URL & ANON KEY ANDA DI SINI **
                supabaseUrl: 'https://bihbjelmkclckgfmsgqu.supabase.co', 
                supabaseAnonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpaGJqZWxta2NsY2tnZm1zZ3F1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0NzU0MzIsImV4cCI6MjA3NTA1MTQzMn0.Mjszb-CHWKFr_IIauiFsa3aE8S70lVXMgKo2oYaIBPA',

                // --- STATE ---
                supabase: null,
                classTypes: ['Practical', 'Tutorial'],
                classRosters: {}, 
                attendanceData: {}, 

                // --- INITIALIZATION ---
                async init() {
                    this.cacheDOM();
                    this.initializeSupabase();
                    await this.loadRostersFromGoogleSheet();
                    await this.loadData();
                    this.bindEvents();
                    this.render();
                    this.setInitialDateTime();
                    this.checkLocalStorageData();
                },

                initializeSupabase() {
                    if (this.supabaseUrl && this.supabaseUrl !== 'PASTE_YOUR_SUPABASE_URL_HERE' && this.supabaseAnonKey && this.supabaseAnonKey !== 'PASTE_YOUR_SUPABASE_ANON_KEY_HERE') {
                        try {
                            this.supabase = supabase.createClient(this.supabaseUrl, this.supabaseAnonKey);
                            this.updateOnlineStatus(true, 'Disambungkan ke Supabase');
                        } catch (error) {
                            console.error('Supabase initialization failed:', error);
                             this.updateOnlineStatus(false, 'Gagal sambung ke Supabase');
                        }
                    } else {
                         this.updateOnlineStatus(false, 'Supabase tidak dikonfigurasi');
                    }
                },
                
                async loadRostersFromGoogleSheet() {
                    if (!this.googleSheetUrl || this.googleSheetUrl === 'PASTE_YOUR_GOOGLE_SHEET_CSV_URL_HERE') {
                        this.showAlert('Pautan Google Sheet tidak ditetapkan. Menggunakan data contoh.', 'error');
                        this.classRosters = {
                            'Contoh Kelas A': [{ name: 'Pelajar Contoh 1', status: 'Active' }, { name: 'Pelajar Contoh 2', status: 'Active' }],
                            'Contoh Kelas B': [{ name: 'Pelajar Contoh 3', status: 'Active' }, { name: 'Pelajar Contoh 4', status: 'Inactive' }]
                        };
                        return;
                    }
                    try {
                        const response = await fetch(this.googleSheetUrl);
                        if (!response.ok) throw new Error(`Ralat rangkaian: ${response.statusText}`);
                        const csvText = await response.text();
                        const rosters = {};
                        const rows = csvText.split('\n').filter(row => row.trim() !== '').slice(1); 
                        rows.forEach(row => {
                            const parts = row.split(',');
                            const className = parts[0]?.trim();
                            const studentName = parts[1]?.trim().replace(/"/g, '');
                            const status = parts[2]?.trim().replace(/\r$/, '') || 'Active';
                            if (className && studentName) {
                                if (!rosters[className]) rosters[className] = [];
                                rosters[className].push({ name: studentName, status: status });
                            }
                        });
                        this.classRosters = rosters;
                        if (Object.keys(this.classRosters).length === 0) {
                            this.showAlert('Gagal memuatkan senarai pelajar. Semak format/pautan Google Sheet.', 'error');
                        } else {
                            this.showAlert('Senarai pelajar berjaya dimuatkan!', 'success');
                        }
                    } catch (error) {
                        console.error('Ralat memuatkan senarai nama:', error);
                        this.showAlert('Gagal memuatkan senarai dari Google Sheet.', 'error');
                        this.classRosters = {
                           'Contoh Kelas A': [{ name: 'Pelajar Contoh 1', status: 'Active' }, { name: 'Pelajar Contoh 2', status: 'Active' }],
                           'Contoh Kelas B': [{ name: 'Pelajar Contoh 3', status: 'Active' }, { name: 'Pelajar Contoh 4', status: 'Inactive' }]
                        };
                    }
                },

                cacheDOM() {
                    this.onlineStatus = document.getElementById('online-status');
                    this.migrateDataBtn = document.getElementById('migrate-data-btn');
                    this.tabs = { entry: document.getElementById('tab-entry'), dashboard: document.getElementById('tab-dashboard'), summary: document.getElementById('tab-summary') };
                    this.content = { entry: document.getElementById('content-entry'), dashboard: document.getElementById('content-dashboard'), summary: document.getElementById('content-summary') };
                    this.entryForm = { date: document.getElementById('entry-date'), time: document.getElementById('entry-time'), class: document.getElementById('entry-class'), classType: document.getElementById('entry-class-type'), studentList: document.getElementById('student-list'), submitBtn: document.getElementById('submit-attendance'), studentListHeader: document.getElementById('student-list-header'), sessionRemarkToggle: document.getElementById('session-remark-toggle'), sessionRemarkContainer: document.getElementById('session-remark-container'), sessionRemarkInput: document.getElementById('session-remark-input') };
                    this.dashboardView = { classSelect: document.getElementById('dashboard-class'), classTypeSelect: document.getElementById('dashboard-class-type'), monthSelect: document.getElementById('dashboard-month'), body: document.getElementById('dashboard-body'), printBtn: document.getElementById('print-report-btn') };
                    this.summaryView = { monthSelect: document.getElementById('summary-month'), body: document.getElementById('summary-body') };
                    this.modal = { container: document.getElementById('remarks-modal'), studentName: document.getElementById('modal-student-name'), content: document.getElementById('modal-remarks-content'), closeBtn: document.getElementById('close-modal') };
                    this.sessionsModal = { container: document.getElementById('sessions-modal'), title: document.getElementById('sessions-modal-title'), content: document.getElementById('sessions-modal-content'), closeBtn: document.getElementById('close-sessions-modal') };
                    this.deleteConfirmModal = { container: document.getElementById('delete-confirm-modal'), message: document.getElementById('delete-confirm-message'), confirmBtn: document.getElementById('confirm-delete-btn'), cancelBtn: document.getElementById('cancel-delete-btn') };
                    this.alert = { container: document.getElementById('custom-alert'), message: document.getElementById('alert-message') };
                    this.printSection = { container: document.getElementById('print-section'), header: document.getElementById('print-header'), table: document.getElementById('print-table'), summary: document.getElementById('print-summary'), footer: document.getElementById('print-footer') };
                },
                
                bindEvents() {
                    this.migrateDataBtn.addEventListener('click', this.migrateData.bind(this));
                    this.tabs.entry.addEventListener('click', () => this.switchTab('entry'));
                    this.tabs.dashboard.addEventListener('click', () => this.switchTab('dashboard'));
                    this.tabs.summary.addEventListener('click', () => this.switchTab('summary'));
                    this.entryForm.submitBtn.addEventListener('click', this.submitAttendance.bind(this));
                    this.entryForm.class.addEventListener('change', this.renderStudentEntryList.bind(this));
                    this.entryForm.sessionRemarkToggle.addEventListener('change', this.toggleSessionRemark.bind(this));
                    this.dashboardView.classSelect.addEventListener('change', this.renderDashboard.bind(this));
                    this.dashboardView.classTypeSelect.addEventListener('change', this.renderDashboard.bind(this));
                    this.dashboardView.monthSelect.addEventListener('change', this.renderDashboard.bind(this));
                    this.dashboardView.printBtn.addEventListener('click', this.generatePrintableReport.bind(this));
                    this.summaryView.monthSelect.addEventListener('change', this.renderSummary.bind(this));
                    this.modal.closeBtn.addEventListener('click', this.closeModal.bind(this));
                    this.modal.container.addEventListener('click', (e) => { if (e.target === this.modal.container) this.closeModal(); });
                    this.sessionsModal.closeBtn.addEventListener('click', this.closeSessionsModal.bind(this));
                    this.sessionsModal.container.addEventListener('click', (e) => { if (e.target === this.sessionsModal.container) this.closeSessionsModal(); });
                    this.deleteConfirmModal.cancelBtn.addEventListener('click', this.closeDeleteConfirmModal.bind(this));
                    this.deleteConfirmModal.confirmBtn.addEventListener('click', this.executeDeleteSession.bind(this));
                },

                // --- DATA MANAGEMENT (Supabase) ---
                async loadData() {
                    if (!this.supabase) {
                        this.showAlert('Sistem berjalan dalam mod luar talian (offline).', 'error');
                        return;
                    }
                    const { data, error } = await this.supabase.from('attendance_records').select('*');
                    if (error) {
                        console.error('Error fetching data:', error);
                        this.showAlert('Gagal memuatkan data dari pangkalan data.', 'error');
                        return;
                    }
                    
                    // Reconstruct the nested object structure from the flat array
                    const reconstructedData = {};
                    data.forEach(record => {
                        const { class_name, class_type, date, time, record_type, details } = record;
                        if (!reconstructedData[class_name]) reconstructedData[class_name] = {};
                        if (!reconstructedData[class_name][class_type]) reconstructedData[class_name][class_type] = [];
                        
                        const newRecord = { date, time };
                        if (record_type === 'session_remark') {
                            newRecord.type = 'session_remark';
                            newRecord.remark = details.remark;
                        } else {
                            newRecord.records = details;
                        }
                        reconstructedData[class_name][class_type].push(newRecord);
                    });
                    this.attendanceData = reconstructedData;
                    this.render();
                },

                // --- UI & RENDER ---
                render() {
                    this.populateClassSelects();
                    this.populateClassTypeSelects();
                    this.populateMonthFilters();
                    this.renderStudentEntryList();
                    this.renderDashboard();
                    this.renderSummary();
                },
                populateClassSelects() {
                    const classNames = Object.keys(this.classRosters);
                    const defaultOption = '<option>Tiada kelas dimuatkan</option>';
                    if (classNames.length === 0) {
                        this.entryForm.class.innerHTML = defaultOption;
                        this.dashboardView.classSelect.innerHTML = defaultOption;
                        return;
                    }
                    const classOptions = classNames.map(c => `<option value="${c}">${c}</option>`).join('');
                    this.entryForm.class.innerHTML = classOptions;
                    this.dashboardView.classSelect.innerHTML = classOptions;
                },
                populateClassTypeSelects() {
                    const classTypeOptions = this.classTypes.map(c => `<option value="${c}">${c}</option>`).join('');
                    this.entryForm.classType.innerHTML = classTypeOptions;
                    this.dashboardView.classTypeSelect.innerHTML = classTypeOptions;
                },
                populateMonthFilters() {
                    const allDates = new Set();
                    Object.values(this.attendanceData).forEach(classData => Object.values(classData).forEach(typeData => typeData.forEach(record => allDates.add(record.date.substring(0, 7)))));
                    const sortedMonths = Array.from(allDates).sort().reverse();
                    const monthOptions = sortedMonths.map(month => {
                        const date = new Date(month + '-02');
                        const monthName = date.toLocaleString('ms-MY', { month: 'long', year: 'numeric' });
                        return `<option value="${month}">${monthName}</option>`;
                    }).join('');
                    const finalOptions = `<option value="all">Semua Bulan</option>` + monthOptions;
                    this.dashboardView.monthSelect.innerHTML = finalOptions;
                    this.summaryView.monthSelect.innerHTML = finalOptions;
                },
                renderStudentEntryList() {
                    const selectedClass = this.entryForm.class.value;
                    const activeStudents = (this.classRosters[selectedClass] || []).filter(s => s.status === 'Active');
                    if (activeStudents.length === 0) {
                        this.entryForm.studentList.innerHTML = `<p class="text-center text-gray-500">Tiada pelajar aktif dijumpai untuk kelas ini.</p>`;
                        return;
                    }
                    this.entryForm.studentList.innerHTML = activeStudents.map((student, index) => `
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center border-t pt-4">
                            <div class="md:col-span-1 font-medium text-gray-700">${student.name}</div>
                            <div class="md:col-span-2"><div class="flex flex-wrap items-center gap-4">
                                <div class="flex items-center"><input id="present-${index}" name="status-${student.name.replace(/\s+/g, '-')}" type="radio" value="present" class="h-4 w-4 text-blue-600 border-gray-300" checked><label for="present-${index}" class="ml-2 block text-sm">Hadir</label></div>
                                <div class="flex items-center"><input id="absent-${index}" name="status-${student.name.replace(/\s+/g, '-')}" type="radio" value="absent" class="h-4 w-4 text-blue-600 border-gray-300"><label for="absent-${index}" class="ml-2 block text-sm">Tidak Hadir</label></div>
                                <div class="flex-grow"><input type="text" placeholder="Sebab (jika tidak hadir)" data-student="${student.name}" class="remarks-input w-full px-2 py-1 border rounded-md text-sm" disabled></div>
                            </div></div>
                        </div>`).join('');
                    this.entryForm.studentList.querySelectorAll('input[type="radio"]').forEach(radio => radio.addEventListener('change', e => {
                        const remarksInput = e.target.closest('.flex-wrap').querySelector('.remarks-input');
                        remarksInput.disabled = e.target.value !== 'absent';
                        if (e.target.value !== 'absent') remarksInput.value = '';
                    }));
                },
                renderDashboard() {
                    const selectedClass = this.dashboardView.classSelect.value;
                    const selectedClassType = this.dashboardView.classTypeSelect.value;
                    const selectedMonth = this.dashboardView.monthSelect.value;
                    const students = this.classRosters[selectedClass] || [];
                    let classData = this.attendanceData[selectedClass]?.[selectedClassType] || [];
                    if (selectedMonth !== 'all') classData = classData.filter(record => record.date.startsWith(selectedMonth));
                    const attendanceSessions = classData.filter(record => record.type !== 'session_remark');
                    if (students.length === 0) {
                        this.dashboardView.body.innerHTML = `<tr><td colspan="4" class="px-6 py-4 text-center">Tiada pelajar untuk kelas ini.</td></tr>`;
                        return;
                    }
                    if (attendanceSessions.length === 0) {
                        this.dashboardView.body.innerHTML = `<tr><td colspan="4" class="px-6 py-4 text-center">Tiada data kehadiran direkodkan bagi penapis yang dipilih.</td></tr>`;
                        return;
                    }
                    const summary = students.map(studentObj => {
                        let presentCount = 0, absentCount = 0;
                        const remarks = [];
                        attendanceSessions.forEach(record => {
                            const studentRecord = record.records[studentObj.name];
                            if (studentRecord) {
                                if (studentRecord.status === 'present') presentCount++;
                                if (studentRecord.status === 'absent') {
                                    absentCount++;
                                    if (studentRecord.remarks) remarks.push({ date: record.date, remark: studentRecord.remarks });
                                }
                            }
                        });
                        const totalRecords = presentCount + absentCount;
                        const percentage = totalRecords > 0 ? ((presentCount / totalRecords) * 100).toFixed(1) : 0;
                        return { ...studentObj, percentage, absentCount, remarks };
                    });
                    this.dashboardView.body.innerHTML = summary.map(s => {
                        const percentageColor = s.percentage >= 80 ? 'bg-green-500' : s.percentage >= 50 ? 'bg-yellow-500' : 'bg-red-500';
                        const statusLabel = s.status === 'Inactive' ? `<span class="text-xs text-gray-500 ml-2">(Tidak Aktif)</span>` : '';
                        return `
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${s.name}${statusLabel}</div></td>
                                <td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center">
                                    <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="${percentageColor} h-2.5 rounded-full" style="width: ${s.percentage}%"></div></div>
                                    <span class="ml-3 text-sm font-medium text-gray-600">${s.percentage}%</span>
                                </div></td>
                                <td class="px-6 py-4 whitespace-nowrap text-center"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s.absentCount > 0 ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">${s.absentCount}</span></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-center"><button ${s.absentCount === 0 ? 'disabled' : ''} data-student-name="${s.name}" class="view-remarks-btn text-blue-600 hover:text-blue-900 disabled:text-gray-400">Papar Sebab</button></td>
                            </tr>`;
                    }).join('');
                    this.dashboardView.body.querySelectorAll('.view-remarks-btn').forEach(btn => btn.addEventListener('click', e => {
                        const studentName = e.target.getAttribute('data-student-name');
                        const studentSummary = summary.find(s => s.name === studentName);
                        if (studentSummary) this.showRemarksModal(studentSummary);
                    }));
                },
                renderSummary() {
                    const selectedMonth = this.summaryView.monthSelect.value;
                    const classNames = Object.keys(this.classRosters);
                    if (classNames.length === 0) {
                        this.summaryView.body.innerHTML = `<tr><td colspan="5" class="px-6 py-4 text-center">Tiada data kelas untuk dipaparkan.</td></tr>`;
                        return;
                    }
                    const summaryHtml = classNames.map(className => {
                        const students = this.classRosters[className] || [];
                        if (students.length === 0) return '';
                        let totalSessions = 0, totalPresentOverall = 0, totalPossibleAttendancesFiltered = 0;
                        const studentStats = {};
                        students.forEach(s => { studentStats[s.name] = { present: 0, total: 0 }; });
                        this.classTypes.forEach(classType => {
                            let records = this.attendanceData[className]?.[classType] || [];
                            if (selectedMonth !== 'all') records = records.filter(record => record.date.startsWith(selectedMonth));
                            const attendanceRecords = records.filter(r => r.type !== 'session_remark');
                            totalSessions += attendanceRecords.length;
                            attendanceRecords.forEach(record => {
                                students.forEach(studentObj => {
                                    const studentRecord = record.records[studentObj.name];
                                    if (studentRecord) {
                                        studentStats[studentObj.name].total++;
                                        if (studentRecord.status === 'present') {
                                            studentStats[studentObj.name].present++;
                                            totalPresentOverall++;
                                        }
                                    }
                                });
                            });
                        });
                        students.forEach(studentObj => { totalPossibleAttendancesFiltered += studentStats[studentObj.name].total; });
                        const overallPercentage = totalPossibleAttendancesFiltered > 0 ? ((totalPresentOverall / totalPossibleAttendancesFiltered) * 100).toFixed(1) : 0;
                        let highest = { name: '-', percentage: -1, status: 'Active' };
                        let lowest = { name: '-', percentage: 101, status: 'Active' };
                        students.forEach(studentObj => {
                            const stats = studentStats[studentObj.name];
                            const percentage = stats.total > 0 ? (stats.present / stats.total) * 100 : 0;
                            if (stats.total > 0) {
                                if (percentage > highest.percentage) highest = { ...studentObj, percentage: percentage.toFixed(1) };
                                if (percentage < lowest.percentage) lowest = { ...studentObj, percentage: percentage.toFixed(1) };
                            }
                        });
                        if (highest.name === '-') highest.percentage = 0;
                        if (lowest.name === '-' || totalSessions === 0) { lowest.name = '-'; lowest.percentage = 0; }
                        const highestStatusLabel = highest.status === 'Inactive' ? ` <span class="text-xs text-gray-500">(Tidak Aktif)</span>` : '';
                        const lowestStatusLabel = lowest.status === 'Inactive' ? ` <span class="text-xs text-gray-500">(Tidak Aktif)</span>` : '';
                        return `
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${className}</div></td>
                                <td class="px-6 py-4 whitespace-nowrap text-center text-sm"><button data-class-name="${className}" class="view-sessions-btn text-blue-600 hover:text-blue-900 underline disabled:text-gray-400" ${totalSessions === 0 ? 'disabled' : ''}>${totalSessions}</button></td>
                                <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-bold">${overallPercentage}%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">${highest.name}${highestStatusLabel} <span class="text-green-600 font-semibold">(${highest.percentage}%)</span></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">${lowest.name}${lowestStatusLabel} <span class="text-red-600 font-semibold">(${lowest.percentage}%)</span></td>
                            </tr>`;
                    }).join('');
                    this.summaryView.body.innerHTML = summaryHtml || `<tr><td colspan="5" class="px-6 py-4 text-center">Tiada data kehadiran direkodkan lagi.</td></tr>`;
                    this.summaryView.body.querySelectorAll('.view-sessions-btn').forEach(btn => btn.addEventListener('click', e => this.showSessionsModal(e.target.getAttribute('data-class-name'))));
                },
                updateOnlineStatus(isOnline, message) {
                    const statusColor = isOnline ? 'bg-green-500' : 'bg-red-500';
                    const statusDot = `<span class="h-3 w-3 rounded-full ${statusColor} inline-block mr-2"></span>`;
                    this.onlineStatus.innerHTML = `<div class="flex items-center text-sm">${statusDot} ${message}</div>`;
                },

                // --- CORE LOGIC ---
                switchTab(tabName) {
                    Object.values(this.content).forEach(c => c.classList.add('hidden'));
                    Object.values(this.tabs).forEach(t => t.classList.remove('tab-active'));
                    this.content[tabName].classList.remove('hidden');
                    this.tabs[tabName].classList.add('tab-active');
                    if (tabName === 'dashboard') this.renderDashboard();
                    if (tabName === 'summary') this.renderSummary();
                },
                
                toggleSessionRemark() {
                    const isChecked = this.entryForm.sessionRemarkToggle.checked;
                    this.entryForm.sessionRemarkContainer.classList.toggle('hidden', !isChecked);
                    this.entryForm.studentListHeader.classList.toggle('hidden', isChecked);
                    this.entryForm.studentList.classList.toggle('hidden', isChecked);
                    this.entryForm.submitBtn.textContent = isChecked ? 'Simpan Catatan Sesi' : 'Catat Kehadiran';
                },

                setInitialDateTime() {
                    const now = new Date();
                    this.entryForm.date.value = now.toISOString().split('T')[0];
                    this.entryForm.time.value = now.toTimeString().split(' ')[0].substring(0, 5);
                },

                async submitAttendance() {
                    if (!this.supabase) { this.showAlert('Gagal menyimpan. Tiada sambungan ke pangkalan data.', 'error'); return; }
                    const className = this.entryForm.class.value;
                    const classType = this.entryForm.classType.value;
                    const date = this.entryForm.date.value;
                    const time = this.entryForm.time.value;
                    if (!date || !time) { this.showAlert('Sila pilih tarikh dan masa.', 'error'); return; }

                    const { data: existing, error: checkError } = await this.supabase.from('attendance_records').select('id').match({ class_name: className, class_type: classType, date: date }).maybeSingle();
                    if (checkError) { this.showAlert(`Ralat: ${checkError.message}`, 'error'); return; }
                    if (existing) { this.showAlert(`Rekod untuk ${className} (${classType}) pada ${date} telah wujud.`, 'error'); return; }

                    let newRecord;
                    if (this.entryForm.sessionRemarkToggle.checked) {
                        const remark = this.entryForm.sessionRemarkInput.value.trim();
                        if (!remark) { this.showAlert('Sila masukkan sebab atau catatan.', 'error'); return; }
                        newRecord = { class_name: className, class_type: classType, date, time, record_type: 'session_remark', details: { remark } };
                    } else {
                        const activeStudents = (this.classRosters[className] || []).filter(s => s.status === 'Active');
                        if (activeStudents.length === 0) { this.showAlert('Tiada pelajar aktif dalam kelas ini.', 'error'); return; }
                        const records = {};
                        activeStudents.forEach(student => {
                            const status = document.querySelector(`input[name="status-${student.name.replace(/\s+/g, '-')}"]:checked`).value;
                            const remarks = document.querySelector(`input.remarks-input[data-student="${student.name}"]`).value.trim();
                            records[student.name] = { status, remarks: status === 'absent' ? remarks : '' };
                        });
                        newRecord = { class_name: className, class_type: classType, date, time, record_type: 'attendance', details: records };
                    }

                    const { error } = await this.supabase.from('attendance_records').insert(newRecord);
                    if (error) {
                        this.showAlert(`Gagal menyimpan data: ${error.message}`, 'error');
                    } else {
                        this.showAlert('Rekod berjaya disimpan secara online!', 'success');
                        this.entryForm.sessionRemarkToggle.checked = false;
                        this.toggleSessionRemark();
                        this.entryForm.sessionRemarkInput.value = '';
                        await this.loadData();
                    }
                },
                
                async executeDeleteSession(e) {
                    if (!this.supabase) { this.showAlert('Gagal memadam. Tiada sambungan ke pangkalan data.', 'error'); return; }
                    const { className, date, type } = e.currentTarget.dataset;
                    const { error } = await this.supabase.from('attendance_records').delete().match({ class_name: className, date: date, class_type: type });
                    if (error) {
                        this.showAlert(`Gagal memadam rekod: ${error.message}`, 'error');
                    } else {
                        this.showAlert('Rekod berjaya dipadam.', 'success');
                    }
                    this.closeDeleteConfirmModal();
                    this.closeSessionsModal();
                    await this.loadData();
                },

                // --- DATA MIGRATION ---
                checkLocalStorageData() {
                    const localData = localStorage.getItem('attendanceData');
                    if (localData && Object.keys(JSON.parse(localData)).length > 0) {
                        this.migrateDataBtn.classList.remove('hidden');
                    }
                },

                async migrateData() {
                    if (!this.supabase) { this.showAlert('Sila konfigurasikan Supabase terlebih dahulu.', 'error'); return; }
                    const localDataRaw = localStorage.getItem('attendanceData');
                    if (!localDataRaw) { this.showAlert('Tiada data lama untuk dipindahkan.', 'error'); return; }
                    
                    this.showAlert('Memindahkan data... Ini mungkin mengambil sedikit masa.', 'success');
                    this.migrateDataBtn.disabled = true;
                    this.migrateDataBtn.textContent = 'Memindahkan...';

                    const localData = JSON.parse(localDataRaw);
                    const recordsToMigrate = [];
                    for (const className in localData) {
                        for (const classType in localData[className]) {
                            localData[className][classType].forEach(record => {
                                const newRecord = {
                                    class_name: className,
                                    class_type: classType,
                                    date: record.date,
                                    time: record.time,
                                    record_type: record.type === 'session_remark' ? 'session_remark' : 'attendance',
                                    details: record.type === 'session_remark' ? { remark: record.remark } : record.records,
                                };
                                recordsToMigrate.push(newRecord);
                            });
                        }
                    }

                    if (recordsToMigrate.length === 0) {
                        this.showAlert('Tiada data untuk dipindahkan.', 'error');
                        return;
                    }
                    
                    // Upsert to avoid duplicates if migration is run multiple times
                    const { error } = await this.supabase.from('attendance_records').upsert(recordsToMigrate, { onConflict: 'class_name,class_type,date' });

                    if (error) {
                         this.showAlert(`Pemindahan gagal: ${error.message}`, 'error');
                         this.migrateDataBtn.disabled = false;
                         this.migrateDataBtn.textContent = 'Cuba Pindah Semula';
                    } else {
                         this.showAlert('Semua data lama berjaya dipindahkan ke pangkalan data online!', 'success');
                         localStorage.removeItem('attendanceData'); // Clear old data after successful migration
                         this.migrateDataBtn.classList.add('hidden');
                         await this.loadData();
                    }
                },
                // --- MODALS, PRINTING, ALERTS ---
                showRemarksModal(studentSummary) {
                    this.modal.studentName.textContent = `Sebab Tidak Hadir untuk ${studentSummary.name}`;
                    this.modal.content.innerHTML = studentSummary.remarks.length > 0 ? studentSummary.remarks.map(r => `
                        <div class="border-l-4 border-blue-500 pl-3 py-1 my-1">
                            <p class="font-semibold">${new Date(r.date + 'T00:00:00').toDateString()}</p>
                            <p>${r.remark || 'Tiada sebab diberikan.'}</p>
                        </div>`).join('') : '<p>Tiada sebab direkodkan.</p>';
                    this.modal.container.classList.remove('hidden');
                },

                closeModal() {
                    this.modal.container.classList.add('hidden');
                },

                showSessionsModal(className) {
                    const selectedMonth = this.summaryView.monthSelect.value;
                    this.sessionsModal.title.textContent = `Senarai Sesi untuk Kelas ${className}`;
                    const sessions = [];
                    this.classTypes.forEach(classType => {
                        let records = this.attendanceData[className]?.[classType] || [];
                        if (selectedMonth !== 'all') {
                            records = records.filter(record => record.date.startsWith(selectedMonth));
                        }
                        records.forEach(record => {
                            if (record.type === 'session_remark') {
                                sessions.push({ ...record, classType, isRemark: true });
                            } else {
                                sessions.push({ ...record, classType, isRemark: false });
                            }
                        });
                    });
                    sessions.sort((a, b) => new Date(`${a.date}T${a.time}`) - new Date(`${b.date}T${b.time}`));
                    this.sessionsModal.content.innerHTML = sessions.length > 0 ? `<ul class="list-disc pl-5 space-y-2">${sessions.map(s => {
                        const displayInfo = s.isRemark ? `<span class="font-semibold text-indigo-600">${s.remark}</span>` : `${s.time} (${s.classType})`;
                        return `<li><div class="flex justify-between items-center">
                                    <div><span class="font-semibold">${new Date(s.date + 'T00:00:00').toDateString()}</span> - ${displayInfo}</div>
                                    <button data-class-name="${className}" data-date="${s.date}" data-type="${s.classType}" class="delete-session-btn text-red-500 hover:text-red-700 p-1 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg></button>
                                </div></li>`;
                    }).join('')}</ul>` : '<p>Tiada sesi direkodkan untuk kelas ini.</p>';
                    this.sessionsModal.content.querySelectorAll('.delete-session-btn').forEach(btn => btn.addEventListener('click', e => this.promptDeleteSession(e.currentTarget.dataset)));
                    this.sessionsModal.container.classList.remove('hidden');
                },

                closeSessionsModal() {
                    this.sessionsModal.container.classList.add('hidden');
                },

                promptDeleteSession({ className, date, type }) {
                    this.deleteConfirmModal.message.textContent = `Adakah anda pasti mahu memadam rekod untuk kelas ${className} (${type}) pada ${date}? Tindakan ini tidak boleh diubah.`;
                    this.deleteConfirmModal.confirmBtn.dataset.className = className;
                    this.deleteConfirmModal.confirmBtn.dataset.date = date;
                    this.deleteConfirmModal.confirmBtn.dataset.type = type;
                    this.deleteConfirmModal.container.classList.remove('hidden');
                },

                closeDeleteConfirmModal() {
                    this.deleteConfirmModal.container.classList.add('hidden');
                },

                generatePrintableReport() {
                    const selectedClass = this.dashboardView.classSelect.value;
                    const selectedClassType = this.dashboardView.classTypeSelect.value;
                    const selectedMonth = this.dashboardView.monthSelect.value;
                    if (selectedMonth === 'all') {
                        this.showAlert('Sila pilih bulan yang spesifik untuk mencetak laporan.', 'error');
                        return;
                    }
                    const students = this.classRosters[selectedClass] || [];
                    const records = this.attendanceData[selectedClass]?.[selectedClassType] || [];
                    const monthRecords = records.filter(r => r.date.startsWith(selectedMonth));
                    const sessionDates = [...new Set(monthRecords.map(r => r.date))].sort();
                    if (sessionDates.length === 0) {
                        this.showAlert('Tiada rekod untuk dicetak bagi bulan yang dipilih.', 'error');
                        return;
                    }
                    const date = new Date(selectedMonth + '-02');
                    const monthName = date.toLocaleString('ms-MY', { month: 'long', year: 'numeric' });
                    this.printSection.header.innerHTML = `
                        <h2 style="font-size: 1.5rem; font-weight: bold;">Laporan Kehadiran Bulanan</h2>
                        <p><strong>Kelas:</strong> ${selectedClass} (${selectedClassType})</p>
                        <p><strong>Bulan:</strong> ${monthName}</p>
                    `;
                    let tableHTML = '<thead><tr><th style="width: 300px;">Nama Pelajar</th>';
                    sessionDates.forEach(dateStr => {
                        const day = new Date(dateStr + 'T00:00:00').getDate();
                        tableHTML += `<th style="width: 20px; text-align: center;">${day}</th>`;
                    });
                    tableHTML += '<th style="text-align: center;">Hadir</th><th style="text-align: center;">Tidak Hadir</th><th style="text-align: center;">%</th></tr></thead>';
                    tableHTML += '<tbody>';
                    students.forEach(studentObj => {
                        let presentCount = 0;
                        let absentCount = 0;
                        tableHTML += `<tr><td>${studentObj.name} ${studentObj.status === 'Inactive' ? '(T/A)' : ''}</td>`;
                        sessionDates.forEach(dateStr => {
                            let cellContent = '';
                            const recordForDay = monthRecords.find(r => r.date === dateStr);
                            if (recordForDay) {
                                if (recordForDay.type === 'session_remark') {
                                    cellContent = 'C';
                                } else if (recordForDay.records[studentObj.name]) {
                                    const status = recordForDay.records[studentObj.name].status;
                                    if (status === 'present') {
                                        cellContent = 'H';
                                        presentCount++;
                                    } else {
                                        cellContent = 'T';
                                        absentCount++;
                                    }
                                }
                            }
                            tableHTML += `<td style="text-align: center;">${cellContent}</td>`;
                        });
                        const totalClasses = presentCount + absentCount;
                        const percentage = totalClasses > 0 ? (presentCount / totalClasses * 100).toFixed(0) : 0;
                        tableHTML += `<td style="text-align: center;">${presentCount}</td>`;
                        tableHTML += `<td style="text-align: center;">${absentCount}</td>`;
                        tableHTML += `<td style="text-align: center;">${percentage}%</td>`;
                        tableHTML += '</tr>';
                    });
                    tableHTML += '</tbody>';
                    this.printSection.table.innerHTML = tableHTML;
                    this.printSection.summary.innerHTML = `
                        <p style="font-size: 0.8rem;"><strong>Petunjuk:</strong> H = Hadir, T = Tidak Hadir, C = Cuti / Acara Khas, (T/A) = Tidak Aktif</p>
                    `;
                    this.printSection.footer.innerHTML = `
                        <div style="margin-top: 40px; display: flex; justify-content: space-between;">
                            <div><p>_________________________</p><p>Tandatangan Guru</p></div>
                            <div><p>Tarikh: ______________</p></div>
                        </div>
                    `;
                    window.print();
                },
                
                showAlert(message, type = 'success') {
                    this.alert.message.textContent = message;
                    this.alert.container.className = `fixed top-5 right-5 z-50 text-white py-2 px-4 rounded-lg shadow-md transition-transform ${type === 'error' ? 'bg-red-500' : 'bg-green-500'} translate-x-0`;
                    setTimeout(() => {
                        this.alert.container.classList.add('translate-x-full');
                        setTimeout(() => this.alert.container.classList.add('hidden'), 300);
                    }, 3000);
                }
            };

            app.init();
        });
    </script>
</body>
</html>

